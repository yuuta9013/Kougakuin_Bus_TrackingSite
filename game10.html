<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>迷路脱出ゲーム</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f9f9f9;
            margin: 0;
            padding: 0;
        }
        .game {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        #mazeArea {
            width: 300px;
            height: 300px;
            background-color: #e0e0e0;
            position: relative;
            border: 2px solid black;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 2px;
        }
        .cell {
            width: 100%;
            height: 100%;
            background-color: white;
            border-radius: 2px;
        }
        .wall {
            background-color: black;
        }
        .player {
            background-color: blue;
        }
        .goal {
            background-color: green;
        }
        #statusDisplay {
            font-size: 1.2em;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
        }
        header {
            background-color: #333;
            color: white;
            padding: 10px 0;
        }
        .menu-btn {
            font-size: 1.5em;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
        }
        nav ul {
            list-style: none;
            padding: 0;
        }
        nav ul li {
            margin: 5px 0;
        }
        nav ul li a {
            color: white;
            text-decoration: none;
        }
        #menu {
            display: none;
            background-color: #444;
            padding: 10px;
        }
    </style>
</head>
<body>
    <header>
        <button class="menu-btn" onclick="toggleMenu()">☰</button>
        <nav id="menu">
            <ul>
                <li><a href="index.html">位置情報</a></li><br>
                <li><a href="notification.html">お知らせ</a></li><br>
                <li><a href="home.html">ミニゲーム</a></li><br>
                <li><a href="https://www.neec.ac.jp/hachioji/" target="_blank">学校ホームページ</a></li>
            </ul>
        </nav>
    </header>

    <section class="game">
        <h1>迷路脱出ゲーム</h1>
        <p>スワイプでプレイヤーを操作して、ゴールを目指そう！</p>
        <div id="mazeArea"></div>
        <p id="statusDisplay">プレイヤーをゴールに導こう！</p>
        <button onclick="startGame()">ゲーム開始</button>
    </section>

    <script>
        const mazeArea = document.getElementById('mazeArea');
        const mazeSize = 10; // 10x10の迷路
        let playerPosition = { x: 0, y: 0 };
        let goalPosition = { x: 9, y: 9 };
        let maze = [];

        function toggleMenu() {
            const menu = document.getElementById("menu");
            menu.style.display = menu.style.display === "none" ? "block" : "none";
        }

        function startGame() {
            playerPosition = { x: 0, y: 0 };
            generateSolvableMaze();
            renderMaze();
            document.getElementById('statusDisplay').innerText = 'プレイヤーをゴールに導こう！';
        }

        function generateSolvableMaze() {
            maze = Array.from({ length: mazeSize }, () =>
                Array.from({ length: mazeSize }, () => 'wall')
            );

            // 迷路の生成（単純な深さ優先探索アルゴリズム）
            let stack = [{ x: 0, y: 0 }];
            maze[0][0] = 'cell';

            while (stack.length > 0) {
                const current = stack.pop();
                const neighbors = getNeighbors(current.x, current.y).filter(n => maze[n.y][n.x] === 'wall');

                if (neighbors.length > 0) {
                    stack.push(current);
                    const next = neighbors[Math.floor(Math.random() * neighbors.length)];
                    maze[next.y][next.x] = 'cell';
                    removeWallBetween(current, next);
                    stack.push(next);
                }
            }

            maze[goalPosition.y][goalPosition.x] = 'goal'; // ゴール位置設定
        }

        function getNeighbors(x, y) {
            const deltas = [
                { dx: -1, dy: 0 },
                { dx: 1, dy: 0 },
                { dx: 0, dy: -1 },
                { dx: 0, dy: 1 }
            ];
            return deltas
                .map(({ dx, dy }) => ({ x: x + dx, y: y + dy }))
                .filter(({ x, y }) => x >= 0 && y >= 0 && x < mazeSize && y < mazeSize);
        }

        function removeWallBetween(a, b) {
            const midX = (a.x + b.x) / 2;
            const midY = (a.y + b.y) / 2;
            maze[midY][midX] = 'cell';
        }

        function renderMaze() {
            mazeArea.innerHTML = '';
            maze.forEach((row, y) => {
                row.forEach((cell, x) => {
                    const div = document.createElement('div');
                    div.className = `cell ${cell}`;
                    if (playerPosition.x === x && playerPosition.y === y) {
                        div.classList.add('player');
                    }
                    mazeArea.appendChild(div);
                });
            });
        }

        function movePlayer(dx, dy) {
            const newX = playerPosition.x + dx;
            const newY = playerPosition.y + dy;

            if (newX >= 0 && newX < mazeSize && newY >= 0 && newY < mazeSize) {
                if (maze[newY][newX] !== 'wall') {
                    playerPosition = { x: newX, y: newY };
                    if (newX === goalPosition.x && newY === goalPosition.y) {
                        document.getElementById('statusDisplay').innerText = 'ゴールしました！おめでとう！';
                        return;
                    }
                    renderMaze();
                }
            }
        }

        let touchStartX = 0;
        let touchStartY = 0;

        mazeArea.addEventListener('touchstart', (e) => {
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
        });

        mazeArea.addEventListener('touchend', (e) => {
            const touch = e.changedTouches[0];
            const deltaX = touch.clientX - touchStartX;
            const deltaY = touch.clientY - touchStartY;

            if (Math.abs(deltaX) > Math.abs(deltaY)) {
                if (deltaX > 0) movePlayer(1, 0); // 右
                else movePlayer(-1, 0); // 左
            } else {
                if (deltaY > 0) movePlayer(0, 1); // 下
                else movePlayer(0, -1); // 上
            }
        });
    </script>
</body>
</html>
