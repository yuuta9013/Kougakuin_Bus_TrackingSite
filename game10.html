<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>横スクロールアクションゲーム - ゲームパッド対応</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            overflow: hidden;
        }
        .game {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        #gameArea {
            width: 800px;
            height: 400px;
            background-color: skyblue;
            overflow: hidden;
            border: 2px solid black;
            position: relative;
        }
        .character {
            width: 40px;
            height: 40px;
            background-color: red;
            position: absolute;
            bottom: 10px;
            left: 100px; /* 初期位置を少し中央に寄せる */
        }
        .ground {
            position: absolute;
            bottom: 0;
            width: 2000px; /* 長い地面 */
            height: 20px;
            background-color: green;
        }
    </style>
</head>
<body>
    <section class="game">
        <h1>横スクロールアクションゲーム - ゲームパッド対応</h1>
        <div id="gameArea">
            <div id="character" class="character"></div>
            <div class="ground"></div>
        </div>
        <p id="status">ゲームパッドでプレイ可能：×ボタンでジャンプ、スティックで左右移動</p>
    </section>

    <script>
        let gamepadIndex = null;
        const character = document.getElementById("character");
        const gameArea = document.getElementById("gameArea");
        const groundHeight = 20;
        const characterSpeed = 3;
        let velocityY = 0;
        let gravity = 0.8;
        let isJumping = false;
        let scrollOffset = 0;

        function gameLoop() {
            if (gamepadIndex !== null) {
                const gamepad = navigator.getGamepads()[gamepadIndex];
                if (gamepad) {
                    // 左スティックで左右移動
                    const axisX = gamepad.axes[0];
                    if (Math.abs(axisX) > 0.2) { // スティックの感度を調整
                        moveCharacter(axisX * characterSpeed);
                    }
                    // ×ボタンでジャンプ (ボタン0)
                    if (gamepad.buttons[0].pressed) {
                        jump();
                    }
                }
            }

            // 重力処理
            if (character.offsetTop < gameArea.clientHeight - groundHeight - character.clientHeight) {
                velocityY += gravity;
                character.style.top = character.offsetTop + velocityY + "px";
            } else {
                velocityY = 0;
                character.style.top = gameArea.clientHeight - groundHeight - character.clientHeight + "px";
                isJumping = false;
            }

            // キャラクターが画面の中央を超えたらスクロール
            const characterLeft = character.offsetLeft;
            if (characterLeft > gameArea.clientWidth / 2) {
                scrollOffset += characterSpeed;
                gameArea.style.backgroundPositionX = -scrollOffset + "px";
                character.style.left = gameArea.clientWidth / 2 + "px"; // キャラクター位置を固定
            } else {
                character.style.left = characterLeft + "px";
            }

            requestAnimationFrame(gameLoop);
        }

        function moveCharacter(dx) {
            const newPos = character.offsetLeft + dx;
            const maxLeft = 0;
            const maxRight = gameArea.clientWidth - character.clientWidth;

            if (newPos > maxLeft && newPos < maxRight) {
                character.style.left = newPos + "px";
            }
        }

        function jump() {
            if (!isJumping) {
                velocityY = -12; // ジャンプの初速度
                isJumping = true;
            }
        }

        window.addEventListener("gamepadconnected", (event) => {
            gamepadIndex = event.gamepad.index;
            document.getElementById("status").textContent = "ゲームパッド接続: プレイ可能";
        });

        window.addEventListener("gamepaddisconnected", () => {
            gamepadIndex = null;
            document.getElementById("status").textContent = "ゲームパッドが切断されました";
        });

        gameLoop(); // ゲームを開始
    </script>
</body>
</html>
