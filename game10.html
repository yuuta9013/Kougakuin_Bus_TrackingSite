<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>フルーツキャッチゲーム</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .game {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
        }
        #gameArea {
            width: 400px;
            height: 600px;
            background-color: #f0f0f0;
            position: relative;
            border: 2px solid black;
            overflow: hidden;
        }
        .character {
            width: 50px;
            height: 50px;
            background-color: blue;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50%;
        }
        .fruit, .bomb {
            width: 30px;
            height: 30px;
            position: absolute;
            top: 0;
            border-radius: 50%;
        }
        .fruit.apple { background-color: red; }
        .fruit.banana { background-color: yellow; }
        .fruit.grape { background-color: purple; }
        .bomb { background-color: black; }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header>
        <button class="menu-btn" onclick="toggleMenu()">☰</button>
        <nav id="menu" style="display: none;">
            <ul>
                <li><a href="index.html">位置情報</a></li><br>
                <li><a href="notification.html">お知らせ</a></li><br>
                <li><a href="home.html">ゲーム一覧</a></li><br>
                <li><a href="https://www.neec.ac.jp/hachioji/" target="_blank">学校ホームページ</a></li>
            </ul>
        </nav>
    </header>

    <section class="game">
        <h1>フルーツキャッチゲーム</h1>
        <p>キャラクターを左右に動かして、フルーツをキャッチしよう！<br>ただし、爆弾には注意！</p>
        <div id="gameArea">
            <div id="character" class="character"></div>
        </div>
        <p id="scoreDisplay">スコア: 0</p>
        <p id="timeDisplay">残り時間: 30秒</p>
        <button onclick="startGame()">ゲーム開始</button>
    </section>

    <script>
        let score = 0;
        let timeLeft = 30;
        let gameInterval, timerInterval;
        const characterSpeed = 10;
        let fruitFallSpeed = 5;

        const gameArea = document.getElementById('gameArea');
        const character = document.getElementById('character');

        function toggleMenu() {
            const menu = document.getElementById("menu");
            menu.style.display = menu.style.display === "none" ? "block" : "none";
        }

        function startGame() {
            score = 0;
            timeLeft = 30;
            fruitFallSpeed = 5;

            document.getElementById('scoreDisplay').innerText = 'スコア: 0';
            document.getElementById('timeDisplay').innerText = '残り時間: 30秒';

            clearInterval(gameInterval);
            clearInterval(timerInterval);

            gameInterval = setInterval(spawnObject, 1000);
            timerInterval = setInterval(updateTimer, 1000);

            document.addEventListener('keydown', moveCharacter);
        }

        function updateTimer() {
            timeLeft--;
            document.getElementById('timeDisplay').innerText = `残り時間: ${timeLeft}秒`;

            if (timeLeft <= 0) {
                clearInterval(gameInterval);
                clearInterval(timerInterval);
                alert(`ゲーム終了！最終スコアは ${score} です！`);
            }

            // 時間経過で難易度を上げる
            if (timeLeft % 10 === 0) {
                fruitFallSpeed += 2;
            }
        }

        function spawnObject() {
            const objectType = Math.random() < 0.8 ? 'fruit' : 'bomb';
            const object = document.createElement('div');
            object.classList.add(objectType);

            if (objectType === 'fruit') {
                const fruitTypes = ['apple', 'banana', 'grape'];
                object.classList.add(fruitTypes[Math.floor(Math.random() * fruitTypes.length)]);
            } else {
                object.classList.add('bomb');
            }

            object.style.left = Math.random() * (gameArea.clientWidth - 30) + 'px';
            gameArea.appendChild(object);

            let fallInterval = setInterval(() => {
                object.style.top = (parseInt(object.style.top) || 0) + fruitFallSpeed + 'px';

                if (checkCollision(object, character)) {
                    handleCollision(object);
                    clearInterval(fallInterval);
                } else if (parseInt(object.style.top) > gameArea.clientHeight) {
                    gameArea.removeChild(object);
                    clearInterval(fallInterval);
                }
            }, 50);
        }

        function moveCharacter(event) {
            const rect = character.getBoundingClientRect();
            if (event.key === 'ArrowLeft' && rect.left > gameArea.getBoundingClientRect().left) {
                character.style.left = (parseInt(character.style.left) || 0) - characterSpeed + 'px';
            } else if (event.key === 'ArrowRight' && rect.right < gameArea.getBoundingClientRect().right) {
                character.style.left = (parseInt(character.style.left) || 0) + characterSpeed + 'px';
            }
        }

        function checkCollision(obj1, obj2) {
            const rect1 = obj1.getBoundingClientRect();
            const rect2 = obj2.getBoundingClientRect();

            return !(
                rect1.top > rect2.bottom ||
                rect1.bottom < rect2.top ||
                rect1.left > rect2.right ||
                rect1.right < rect2.left
            );
        }

        function handleCollision(object) {
            if (object.classList.contains('fruit')) {
                if (object.classList.contains('apple')) score += 10;
                else if (object.classList.contains('banana')) score += 15;
                else if (object.classList.contains('grape')) score += 20;
                document.getElementById('scoreDisplay').innerText = 'スコア: ' + score;
            } else if (object.classList.contains('bomb')) {
                score -= 20;
                document.getElementById('scoreDisplay').innerText = 'スコア: ' + score;
            }
            gameArea.removeChild(object);
        }
    </script>
</body>
</html>
